<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Te Deum Practice Player</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f2f5; margin: 0; }
        .player-card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); width: 360px; }
        h2 { margin-top: 0; color: #333; font-size: 1.4rem; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .control-group { margin-bottom: 1.2rem; }
        label { display: block; margin-bottom: 0.4rem; font-weight: bold; font-size: 0.85rem; color: #555; }
        select, input[type="range"] { width: 100%; cursor: pointer; }
        .btn-main { width: 100%; padding: 14px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 1rem; }
        .btn-main:hover { background: #218838; }
        .status-text { display: flex; justify-content: space-between; font-size: 0.8rem; color: #777; margin-top: 4px; }
    </style>
</head>
<body>

<div class="player-card">
    <h2>Te Deum Player</h2>
    
    <div class="control-group">
        <label>Select Track</label>
        <select id="trackSelector">
            <option value="Jubilate.mp3">Te Deum (Full Mix)</option>
            <option value="mp3s/Te Deum - Soprano.mp3">Soprano Part</option>
            <option value="mp3s/Te Deum - Alto.mp3">Alto Part</option>
            <option value="mp3s/Te Deum - Tenor.mp3">Tenor Part</option>
            <option value="mp3s/Te Deum - Bass.mp3">Bass Part</option>
        </select>
    </div>

    <audio id="audioSource" crossorigin="anonymous"></audio>

    <div class="control-group">
        <label>Position</label>
        <input type="range" id="progressBar" value="0" min="0">
        <div class="status-text">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
        </div>
    </div>

    <div class="control-group">
        <label>Volume</label>
        <input type="range" id="volume" min="0" max="1" step="0.05" value="0.8">
    </div>

    <div class="control-group">
        <label>Balance (Left - Right)</label>
        <input type="range" id="panner" min="-1" max="1" step="0.1" value="0">
    </div>

    <div class="control-group">
        <label>Speed: <span id="speedLabel">1.0</span>x</label>
        <input type="range" id="speed" min="0.5" max="1.5" step="0.1" value="1.0">
    </div>

    <button id="playBtn" class="btn-main">Play / Pause</button>
</div>

<script>
    const audio = document.getElementById('audioSource');
    const trackSelector = document.getElementById('trackSelector');
    const playBtn = document.getElementById('playBtn');
    const volumeControl = document.getElementById('volume');
    const pannerControl = document.getElementById('panner');
    const speedControl = document.getElementById('speed');
    const progressBar = document.getElementById('progressBar');

    let audioCtx;
    let pannerNode;
    let gainNode;
    let sourceNode;

    // Initialize Web Audio Graph
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            sourceNode = audioCtx.createMediaElementSource(audio);
            pannerNode = audioCtx.createStereoPanner();
            gainNode = audioCtx.createGain();

            // Routing: Source -> Panner -> Gain (Volume) -> Destination
            sourceNode.connect(pannerNode).connect(gainNode).connect(audioCtx.destination);
            
            // Set initial volume
            gainNode.gain.value = volumeControl.value;
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    // Set initial file path
    audio.src = trackSelector.value;

    playBtn.addEventListener('click', () => {
        initAudio(); 

        if (audio.paused) {
            audio.play();
            playBtn.innerText = "Pause";
        } else {
            audio.pause();
            playBtn.innerText = "Play";
        }
    });

    trackSelector.onchange = () => {
        audio.src = trackSelector.value;
        if (!audio.paused) audio.play();
    };

    volumeControl.oninput = () => {
        if (gainNode) gainNode.gain.value = volumeControl.value;
    };

    pannerControl.oninput = () => {
        if (pannerNode) pannerNode.pan.value = pannerControl.value;
    };

    speedControl.oninput = () => {
        audio.playbackRate = speedControl.value;
        document.getElementById('speedLabel').innerText = speedControl.value;
    };

    // Progress Bar Handling
    audio.ontimeupdate = () => {
        progressBar.value = audio.currentTime;
        document.getElementById('currentTime').innerText = formatTime(audio.currentTime);
    };

    audio.onloadedmetadata = () => {
        progressBar.max = audio.duration;
        document.getElementById('duration').innerText = formatTime(audio.duration);
    };

    progressBar.oninput = () => {
        audio.currentTime = progressBar.value;
    };

    function formatTime(s) {
        const mins = Math.floor(s / 60);
        const secs = Math.floor(s % 60);
        return mins + ":" + (secs < 10 ? "0" + secs : secs);
    }
</script>
</body>
</html>



